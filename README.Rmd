---
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Analyzing Differences in Iowa Counties' Spending

#### Alexander M. Todd - November 23rd, 2025

## Introduction

Government's spend money on various different services. With many ways to collect and spend money, there is significant variety in how a Government allocated funds. The goal of this report is to understand the differences in how the various counties in Iowa collect, allocate, and spend its wealth.

The questions explored in this report are:

1. 

2. 

3. 

4. 

## Data

### Original Data

The data used in this report comes from the [State of Iowa Open Data Website](https://data.iowa.gov/). There were 5 sets of data utilized in this report:

1.  [Annual Personal Income by County](https://data.iowa.gov/Economic-Statistics/Annual-Personal-Income-for-State-of-Iowa-by-County/st2k-2ti2/about_data)

Included is the 'Personal Income' and 'Personal Income Per Capita' for each Iowa County for each year between 1997 and 2022.

2.  [County Actual Revenues](https://data.iowa.gov/Local-Government-Finance/County-Actual-Revenues-By-Type-By-Fiscal-Year/fp2u-f5hd/about_data)

Included is the Total Revenue gained by each Iowa County for each year between 2010 and 2024. There are many variables that split the Revenue by type, most notably the revenue levied by Property Tax and that provided by county issued goods and services.

3.  [County Budgeted Expenditures](https://data.iowa.gov/Local-Government-Finance/County-Budgeted-Expenditures-By-Service-Area-By-Fi/gk9s-gz9c/about_data)

Included is the budgeted spending for each Iowa County for each year between 2005 and 2026. The budget is split based on type of spending for which the money is allocated in the budget.

4.  [County Actual Expenditures](https://data.iowa.gov/Local-Government-Finance/County-Actual-Expenditures-by-Service-Area-by-Fisc/fxbr-vb9c/about_data)

Included is actual spending for each Iowa County for each year between 2010 and 2024. The spending is split based on type of spending for which the money was used.

5.  [County Population](https://data.iowa.gov/Community-Demographics/County-Population-in-Iowa-by-Year/qtnr-zsrc/about_data)

Included is the number of people in each Iowa County for each year between 1990 and 2024.

### Data Preparation and Cleaning

The first step in this process is to read the data sets using readr's read_csv function. 

```{r}
library(tidyverse)
library(lubridate)

pop_raw <- read_csv("data/County_Population_in_Iowa_by_Year_20251123.csv")

# view(pop_raw)

income_raw <- read_csv("data/Annual_Personal_Income_for_State_of_Iowa_by_County_20251123.csv")

# view(income_raw)

rev_raw <- read_csv("data/County_Actual_Revenues_By_Type_By_Fiscal_Year_20251123.csv")

# view(rev_raw)

budget_raw <- read_csv("data/County_Budgeted_Expenditures_By_Service_Area_By_Fiscal_Year_20251123.csv")

# view(budget_raw)

spend_raw <- read_csv("data/County_Actual_Expenditures_by_Service_Area_by_Fiscal_Year_20251123.csv")

# view(spend_raw)

```

The next step is to begin cleaning each data set on various thing:
1. Selecting the correct attributes as the proper variable type
2. Making a cohesive date and county name attribute to make joining tables easier
3. Filter out data with a year not in a shared range. In this case, there is sufficient data in each data set to use the years 2010 to 2022.
4. Editing any variables to make them look nice and creating any calculated fields that might be important later.

*Population Data*

In cleaning the Iowa County Population data, the only requirement was reformatting the county name as just the name of the county in all uppercase (for example, "Story County" becomes "STORY") as well as extracting the year from the date, filtering by years between 2010 and 2024 and only keeping County, Year, and Population columns.

```{r}

pop_raw$County <- replace(pop_raw$County, pop_raw$County == "O'Brien County", "Obrien County")

pop <- pop_raw |>
  mutate(
    County = toupper(substring(County, 1, nchar(County) - 7)),
    Year = year(mdy(Year))
  ) |>
  filter(Year >= 2010, Year <= 2022) |>
  select(County, Year, Population)

str(pop)

```

*Income Data*

In cleaning the Iowa County Annual Personal Income Data, the County names had to be reformatted in uppercase and the year needed to be extracted from the date. The data had to be filtered between the years 2010 and 2024. Finally, the pivot_wider function was utilized to make distinct columns for "Personal Income" and "Personal Income Per Capita" and because the values utilized a dollar sign, the parse_number function was utilized to make it numerical and remove the dollar sign. Finally, as the personal income was in thousands of dollars, it was multiplied by 1000 to make it consistent and easily used.

```{r}

income_raw$Name <- replace(income_raw$Name, income_raw$Name == "O'Brien", "Obrien")

income_1 <- income_raw |>
  mutate(
    County = toupper(Name),
    Year = year(mdy(Date))
  ) |>
  filter(Year >= 2010, Year <= 2022) |>
  select(County, Year, Variable, Value)

income <- income_1 |>
  pivot_wider(names_from = Variable,
              values_from = Value
              ) |>
  rename('Personal_Income' = `Personal income`,
         'Personal_Income_Per_Capita' = `Per capita personal income`
         ) |>
  mutate(
    Personal_Income = parse_number(Personal_Income),
    Personal_Income_Per_Capita = parse_number(Personal_Income_Per_Capita),
    Personal_Income = Personal_Income * 1000
  )

str(income)

```

*Revenue Data*

In cleaning the Iowa County Actual Revenue Data, the County name was standardized to fit the other data sets to be all uppercase letters. The important variable here to keep was "Total Revenue" and simple percentages of how much of the County's total revenue came from what.

"Revenue_Percent_Property_Tax" is the percent of Total Revenue that comes from Property Taxes (in addition to the "Delinquent" or late property taxes either paid or failed to be paid during the year).

"Revenue_Percent_Grant" is the percent of Total Revenue that comes from "Intergovernmental" sources, most commonly as grants from the State of Iowa or the Federal Government.

"Revenue_Percent_Activities" is the percent of Total Revenue that comes from people choosing to spend money for Government goods and services such as rent, interest from borrowed money, licenses, and permits. 

"Revenue_Percent_Other" is simply the percent of Total Revenue that comes from any other source.

```{r}

rev <- rev_raw |>
  rename(
    Year = `FISCAL YEAR`,
    County = `COUNTY NAME`,
    Total_Revenue = `TOTAL REVENUES & OTHER SOURCES`
  ) |>
  mutate(
    County = toupper(County),
    Revenue_Percent_Property_Tax = round((`NET CURRENT PROPERTY TAXES` + `DELINQUENT PROPERTY TAX REVENUE`) / Total_Revenue, 4),
    Revenue_Percent_Grant = round(INTERGOVERNMENTAL / Total_Revenue, 4),
    Revenue_Percent_Activities = round((`LICENSES & PERMITS` + `CHARGES FOR SERVICE` + `USE OF MONEY & PROPERTY`) / Total_Revenue, 4),
    Revenue_Percent_Other = round(1 - Revenue_Percent_Property_Tax - Revenue_Percent_Grant - Revenue_Percent_Activities, 4)
  ) |>
  filter(Year >= 2010, Year <= 2022) |>
  select(County, Year, Total_Revenue, Revenue_Percent_Property_Tax, Revenue_Percent_Grant, Revenue_Percent_Activities, Revenue_Percent_Other)

str(rev)

```

*Budgeted Expenditure Data*

In cleaning the Iowa County Budgeted Expenditures Data, the County Name was already in the desired format. The year was extracted from the date and used to filter to ensure the data was between 2010 and 2024. "Total Budget" was kept and the various types of spending were transformed as a percentage of "Total Budget". The parse_number function was utilized as the numbers used the dollar sign and commas.

```{r}

budget_raw$`County Name` <- replace(budget_raw$`County Name`, budget_raw$`County Name` == "O'BRIEN", "OBRIEN")

budget <- budget_raw |>
  rename(
    County_Id = County,
    County = `County Name`,
    Year = `Fiscal Year Ending`,
    Total_Budget = `Total Expenditures`
  ) |>
  mutate(
    Year = year(mdy(Year)),
    Total_Budget = parse_number(Total_Budget),
    Budgeted_Public_Safety_Percent = parse_number(`Public Safety & Legal Services`) / Total_Budget,
    Budgeted_Mental_Health_Percent = parse_number(`Mental Health MR, DD`) / Total_Budget,
    Budgeted_Roads_Transportation_Percent = parse_number(`Roads & Transportation`) / Total_Budget,
    Budgeted_Administration_Percent = parse_number(Administration) / Total_Budget,
    Budgeted_Debt_Percent = parse_number(`Debt Service`) / Total_Budget,
    Budgeted_Physical_Health_Percent = parse_number(`Physical Health & Social Services`) / Total_Budget,
    Budgeted_Environment_Education_Percent = parse_number(`County Environment & Education`) / Total_Budget,
    Budgeted_Services_to_Residents_Percent = parse_number(`Government Services to Residents`) / Total_Budget,
    Budgeted_Refunded_Programs_Percent = parse_number(`Nonprogram Current`) / Total_Budget,
    Budgeted_Projects_Percent = parse_number(`Capital Projects`) / Total_Budget,
    Budgeted_Transfers_Out_Percent = parse_number(`Operating Transfers Out`) / Total_Budget,
    Budgeted_Refunded_Debt_Percent = parse_number(`Refunded Debt/Escrow`) / Total_Budget
  ) |>
  select(County, Year, Total_Budget, Budgeted_Public_Safety_Percent, Budgeted_Mental_Health_Percent, Budgeted_Roads_Transportation_Percent, Budgeted_Administration_Percent, Budgeted_Debt_Percent, Budgeted_Physical_Health_Percent, Budgeted_Environment_Education_Percent, Budgeted_Services_to_Residents_Percent, Budgeted_Refunded_Programs_Percent, Budgeted_Projects_Percent, Budgeted_Transfers_Out_Percent, Budgeted_Refunded_Debt_Percent) |>
  filter(Year >= 2010, Year <= 2022)

str(budget)

```

*Actual Expenditure Data*

In cleaning the Iowa County Actual Expenditures Data, the County Name and Year were already in the desired format. The year was used to filter to ensure the data was between 2010 and 2024. "Total Expenditures" was kept and the various types of spending were transformed as a percentage of "Total Budget". 

```{r}

spend <- spend_raw |>
  rename(
    Year = `FISCAL YEAR`,
    Total_Expenditure = `TOTAL EXPENDITURES & OTHER USES`
  ) |>
  mutate(
    Actual_Public_Safety_Percent = `PUBLIC SAFETY AND LEGAL SERVICES` / Total_Expenditure,
    Actual_Mental_Health_Percent = `MENTAL HEALTH, ID & DD` / Total_Expenditure,
    Actual_Roads_Transportation_Percent = `ROADS & TRANSPORTATION` / Total_Expenditure,
    Actual_Administration_Percent = ADMINISTRATION / Total_Expenditure,
    Actual_Debt_Percent = `DEBT SERVICE` / Total_Expenditure,
    Actual_Physical_Health_Percent = `PHYSICAL HEALTH SOCIAL SERVICES` / Total_Expenditure,
    Actual_Environment_Education_Percent = `COUNTY ENVIRONMENT AND EDUCATION` / Total_Expenditure,
    Actual_Services_to_Residents_Percent = `GOVERNMENT SERVICES TO RESIDENTS` / Total_Expenditure,
    Actual_Refunded_Programs_Percent = `NONPROGRAM CURRENT` / Total_Expenditure,
    Actual_Projects_Percent = `CAPITAL PROJECTS` / Total_Expenditure,
    Actual_Transfers_Out_Percent = `OPERATING TRANSFERS OUT` / Total_Expenditure,
    Actual_Refunded_Debt_Percent = `REFUNDED DEBT/PAYMENTS TO ESCROW` / Total_Expenditure
  ) |>
  select(County, Year, Total_Expenditure, Actual_Public_Safety_Percent, Actual_Mental_Health_Percent, Actual_Roads_Transportation_Percent, Actual_Administration_Percent, Actual_Debt_Percent, Actual_Physical_Health_Percent, Actual_Environment_Education_Percent, Actual_Services_to_Residents_Percent, Actual_Refunded_Programs_Percent, Actual_Projects_Percent, Actual_Transfers_Out_Percent, Actual_Refunded_Debt_Percent) |>
  filter(Year >= 2010, Year <= 2022)

str(spend)

```

Now that each data set has been cleaned individually, they can now be joined on "County" and "Year".

```{r}

join1 <- inner_join(pop, income, by = c('County', 'Year'))
join2 <- inner_join(join1, rev, by = c('County', 'Year'))
join3 <- inner_join(join2, budget, by = c('County', 'Year'))
data <- inner_join(join3, spend, by = c('County', 'Year'))

# data |>
#  group_by(Year) |>
#  summarize(
#    count = n_distinct(County)
#  )

# sort(unique(data$County))
```

After checking that the join worked, it seemed that the use of an apostrophe in some data sets for O'Brien county did not work with the ones that did not so it was necessary to ensure this was fixed by going back and ensuring that any entry in the data sets with an apostrophe were replaced with the name without.

### Data Structure

```{r}

write.csv(data, 'data/Final_Data.csv')
str(data)
head(data, 5)

```

There are 1287 observations in this data set. This is to be expected considering there are 99 counties and 13 years considered between 2010 and 2022. 99 * 13 is 1287 meaning that each county is represented for each year. 

**Variables**

- County: The Name of the County in Iowa.

- Year: The Year of the Observation (between 2010 and 2022).

- Population: The Number of People Living in the County during the Year.

- Personal_Income: Total Number of Personal Income Earned.

- Personal_Income_Per_Capita: Total Personal Income divided by Population (*Note that this number comes from the State of Iowa Database and is not the number based on the Population and Personal_Income variables in the data set).

- Total_Revenue: Total Revenue brought in by the County during the Year.

- Revenue_Percent_Property_Tax: Percent of Total_Revenue that comes from Property Taxes.

- Revenue_Percent_Grant: Percent of Total_Revenue that comes from Grants from other Governments.

- Revenue_Percent_Activities: Percent of Total_Revenue that comes from Licenses/Permits, Charges for Government Goods and Services, and from the Use of Government Money and Property.

- Revenue_Percent_Other: Percent of Total_Revenue that comes from any other activity not already distinguished.

- Total_Budget: Total Annual Budget allocated by the County.

- Budgeted_Public_Safety_Percent: Percent of Total_Budget allocated to Public Safety.

- Budgeted_Mental_Health_Percent: Percent of Total_Budget allocated to Mental Health.

- Budgeted_Roads_Transportation_Percent: Percent of Total_Budget allocated to Roads and Transportation.

- Budgeted_Administration_Percent: Percent of Total_Budget allocated to Administration Expenses.

- Budgeted_Debt_Percent: Percent of Total_Budget allocated to repaying Debt.

- Budgeted_Physical_Health_Percent: Percent of Total_Budget allocated to Physical Health.

- Budgeted_Environment_Education_Percent: Percent of Total_Budget allocated to the Environment and Education.

- Budgeted_Services_to_Residents_Percent: Percent of Total_Budget allocated to Public Services.

- Budgeted_Refunded_Programs_Percent: Percent of Total_Budget allocated to "NonProgram Current" which includes the allocation of refunds from prior year revenues, pass-through grants, and county farm expenses.

- Budgeted_Projects_Percent: Percent of Total_Budget allocated to the completion of Capital Improvement Projects.

- Budgeted_Transfers_Out_Percent: Percent of Total_Budget allocated to loan transferring to repaying past Budgets.

- Budgeted_Refunded_Debt_Percent: Percent of Total_Budget allocated to repaying Debt Principals.

- Total_Expenditure: Total Actual Annual Expenditures by the County

- Actual_Public_Safety_Percent: Percent of Total_Expenditure spent on Public Safety.

- Actual_Mental_Health_Percent: Percent of Total_Expenditure spent on Mental Health.

- Actual_Roads_Transportation_Percent: Percent of Total_Expenditure spent on Roads and Transportation.

- Actual_Administration_Percent: Percent of Total_Expenditure spent on Administration Expenses.

- Actual_Debt_Percent: Percent of Total_Expenditure spent on repaying Debt.

- Actual_Physical_Health_Percent: Percent of Total_Expenditure spent on Physical Health.

- Actual_Environment_Education_Percent: Percent of Total_Expenditure spent on the Environment and Education.

- Actual_Services_to_Residents_Percent: Percent of Total_Expenditure spent on Public Services.

- Actual_Refunded_Programs_Percent: Percent of Total_Expenditure spent on "NonProgram Current" which includes the allocation of refunds from prior year revenues, pass-through grants, and county farm expenses.

- Actual_Projects_Percent: Percent of Total_Expenditure spent on the completion of Capital Improvement Projects.

- Actual_Transfers_Out_Percent: Percent of Total_Expenditure spent on loan transferring to repaying past Budgets.

- Actual_Refunded_Debt_Percent: Percent of Total_Expenditure spent on repaying Debt Principals.

## Results

### QUESTION 1

### QUESTION 2

### QUESTION 3

### QUESTION 4

## Conclusion
