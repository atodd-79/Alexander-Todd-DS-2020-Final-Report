---
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Analyzing Differences in Iowa Counties' Spending

#### Alexander M. Todd - November 23rd, 2025

## Introduction

Government's spend money on various different services. With many ways to collect and spend money, there is significant variety in how a Government allocated funds. The goal of this report is to understand the differences in how the various counties in Iowa collect, allocate, and spend its wealth.

The questions explored in this report are:

1. What are the general differences between counties in how much they make? 
How is this affected by a county’s population?
Does population affect how a county receives most of its funds?

2. What are the general differences between counties in how much they spend? 
How is this affected by a county’s population? How has this changed over time?
Does population and income affect what a county spends its money on? 

3. For each spending type, what is the difference between budgeted and actual expenditures?

4. What counties are the best at following their budget and revenue?
How has this changed over time?

## Data

### Original Data

The data used in this report comes from the [State of Iowa Open Data Website](https://data.iowa.gov/). There were 5 sets of data utilized in this report:

1.  [Annual Personal Income by County](https://data.iowa.gov/Economic-Statistics/Annual-Personal-Income-for-State-of-Iowa-by-County/st2k-2ti2/about_data)

Included is the 'Personal Income' and 'Personal Income Per Capita' for each Iowa County for each year between 1997 and 2022.

2.  [County Actual Revenues](https://data.iowa.gov/Local-Government-Finance/County-Actual-Revenues-By-Type-By-Fiscal-Year/fp2u-f5hd/about_data)

Included is the Total Revenue gained by each Iowa County for each year between 2010 and 2024. There are many variables that split the Revenue by type, most notably the revenue levied by Property Tax and that provided by county issued goods and services.

3.  [County Budgeted Expenditures](https://data.iowa.gov/Local-Government-Finance/County-Budgeted-Expenditures-By-Service-Area-By-Fi/gk9s-gz9c/about_data)

Included is the budgeted spending for each Iowa County for each year between 2005 and 2026. The budget is split based on type of spending for which the money is allocated in the budget.

4.  [County Actual Expenditures](https://data.iowa.gov/Local-Government-Finance/County-Actual-Expenditures-by-Service-Area-by-Fisc/fxbr-vb9c/about_data)

Included is actual spending for each Iowa County for each year between 2010 and 2024. The spending is split based on type of spending for which the money was used.

5.  [County Population](https://data.iowa.gov/Community-Demographics/County-Population-in-Iowa-by-Year/qtnr-zsrc/about_data)

Included is the number of people in each Iowa County for each year between 1990 and 2024.

### Data Preparation and Cleaning

The first step in this process is to read the data sets using readr's read_csv function. 

```{r}
library(tidyverse)
library(lubridate)

pop_raw <- read_csv("data/County_Population_in_Iowa_by_Year_20251123.csv")

# view(pop_raw)

income_raw <- read_csv("data/Annual_Personal_Income_for_State_of_Iowa_by_County_20251123.csv")

# view(income_raw)

rev_raw <- read_csv("data/County_Actual_Revenues_By_Type_By_Fiscal_Year_20251123.csv")

# view(rev_raw)

budget_raw <- read_csv("data/County_Budgeted_Expenditures_By_Service_Area_By_Fiscal_Year_20251123.csv")

# view(budget_raw)

spend_raw <- read_csv("data/County_Actual_Expenditures_by_Service_Area_by_Fiscal_Year_20251123.csv")

# view(spend_raw)

```

The next step is to begin cleaning each data set on various thing:
1. Selecting the correct attributes as the proper variable type
2. Making a cohesive date and county name attribute to make joining tables easier
3. Filter out data with a year not in a shared range. In this case, there is sufficient data in each data set to use the years 2010 to 2022.
4. Editing any variables to make them look nice and creating any calculated fields that might be important later.

*Population Data*

In cleaning the Iowa County Population data, the only requirement was reformatting the county name as just the name of the county in all uppercase (for example, "Story County" becomes "STORY") as well as extracting the year from the date, filtering by years between 2010 and 2024 and only keeping County, Year, and Population columns.

```{r}

pop_raw$County <- replace(pop_raw$County, pop_raw$County == "O'Brien County", "Obrien County")

pop <- pop_raw |>
  mutate(
    County = toupper(substring(County, 1, nchar(County) - 7)),
    Year = year(mdy(Year))
  ) |>
  filter(Year >= 2010, Year <= 2022) |>
  select(County, Year, Population)

str(pop)

```

*Income Data*

In cleaning the Iowa County Annual Personal Income Data, the County names had to be reformatted in uppercase and the year needed to be extracted from the date. The data had to be filtered between the years 2010 and 2024. Finally, the pivot_wider function was utilized to make distinct columns for "Personal Income" and "Personal Income Per Capita" and because the values utilized a dollar sign, the parse_number function was utilized to make it numerical and remove the dollar sign. Finally, as the personal income was in thousands of dollars, it was multiplied by 1000 to make it consistent and easily used.

```{r}

income_raw$Name <- replace(income_raw$Name, income_raw$Name == "O'Brien", "Obrien")

income_1 <- income_raw |>
  mutate(
    County = toupper(Name),
    Year = year(mdy(Date))
  ) |>
  filter(Year >= 2010, Year <= 2022) |>
  select(County, Year, Variable, Value)

income <- income_1 |>
  pivot_wider(names_from = Variable,
              values_from = Value
              ) |>
  rename('Personal_Income' = `Personal income`,
         'Personal_Income_Per_Capita' = `Per capita personal income`
         ) |>
  mutate(
    Personal_Income = parse_number(Personal_Income),
    Personal_Income_Per_Capita = parse_number(Personal_Income_Per_Capita),
    Personal_Income = Personal_Income * 1000
  )

str(income)

```

*Revenue Data*

In cleaning the Iowa County Actual Revenue Data, the County name was standardized to fit the other data sets to be all uppercase letters. The important variable here to keep was "Total Revenue" and simple percentages of how much of the County's total revenue came from what.

"Revenue_Percent_Property_Tax" is the percent of Total Revenue that comes from Property Taxes (in addition to the "Delinquent" or late property taxes either paid or failed to be paid during the year).

"Revenue_Percent_Grant" is the percent of Total Revenue that comes from "Intergovernmental" sources, most commonly as grants from the State of Iowa or the Federal Government.

"Revenue_Percent_Activities" is the percent of Total Revenue that comes from people choosing to spend money for Government goods and services such as rent, interest from borrowed money, licenses, and permits. 

"Revenue_Percent_Other" is simply the percent of Total Revenue that comes from any other source.

```{r}

rev <- rev_raw |>
  rename(
    Year = `FISCAL YEAR`,
    County = `COUNTY NAME`,
    Total_Revenue = `TOTAL REVENUES & OTHER SOURCES`
  ) |>
  mutate(
    County = toupper(County),
    Revenue_Percent_Property_Tax = round((`NET CURRENT PROPERTY TAXES` + `DELINQUENT PROPERTY TAX REVENUE`) / Total_Revenue, 4),
    Revenue_Percent_Grant = round(INTERGOVERNMENTAL / Total_Revenue, 4),
    Revenue_Percent_Activities = round((`LICENSES & PERMITS` + `CHARGES FOR SERVICE` + `USE OF MONEY & PROPERTY`) / Total_Revenue, 4),
    Revenue_Percent_Other = round(1 - Revenue_Percent_Property_Tax - Revenue_Percent_Grant - Revenue_Percent_Activities, 4)
  ) |>
  filter(Year >= 2010, Year <= 2022) |>
  select(County, Year, Total_Revenue, Revenue_Percent_Property_Tax, Revenue_Percent_Grant, Revenue_Percent_Activities, Revenue_Percent_Other)

str(rev)

```

*Budgeted Expenditure Data*

In cleaning the Iowa County Budgeted Expenditures Data, the County Name was already in the desired format. The year was extracted from the date and used to filter to ensure the data was between 2010 and 2024. "Total Budget" was kept and the various types of spending were transformed as a percentage of "Total Budget". The parse_number function was utilized as the numbers used the dollar sign and commas.

```{r}

budget_raw$`County Name` <- replace(budget_raw$`County Name`, budget_raw$`County Name` == "O'BRIEN", "OBRIEN")

budget <- budget_raw |>
  rename(
    County_Id = County,
    County = `County Name`,
    Year = `Fiscal Year Ending`,
    Total_Budget = `Total Expenditures`
  ) |>
  mutate(
    Year = year(mdy(Year)),
    Total_Budget = parse_number(Total_Budget),
    Budgeted_Public_Safety_Percent = parse_number(`Public Safety & Legal Services`) / Total_Budget,
    Budgeted_Mental_Health_Percent = parse_number(`Mental Health MR, DD`) / Total_Budget,
    Budgeted_Roads_Transportation_Percent = parse_number(`Roads & Transportation`) / Total_Budget,
    Budgeted_Administration_Percent = parse_number(Administration) / Total_Budget,
    Budgeted_Debt_Percent = parse_number(`Debt Service`) / Total_Budget,
    Budgeted_Physical_Health_Percent = parse_number(`Physical Health & Social Services`) / Total_Budget,
    Budgeted_Environment_Education_Percent = parse_number(`County Environment & Education`) / Total_Budget,
    Budgeted_Services_to_Residents_Percent = parse_number(`Government Services to Residents`) / Total_Budget,
    Budgeted_Refunded_Programs_Percent = parse_number(`Nonprogram Current`) / Total_Budget,
    Budgeted_Projects_Percent = parse_number(`Capital Projects`) / Total_Budget,
    Budgeted_Transfers_Out_Percent = parse_number(`Operating Transfers Out`) / Total_Budget,
    Budgeted_Refunded_Debt_Percent = parse_number(`Refunded Debt/Escrow`) / Total_Budget
  ) |>
  select(County, Year, Total_Budget, Budgeted_Public_Safety_Percent, Budgeted_Mental_Health_Percent, Budgeted_Roads_Transportation_Percent, Budgeted_Administration_Percent, Budgeted_Debt_Percent, Budgeted_Physical_Health_Percent, Budgeted_Environment_Education_Percent, Budgeted_Services_to_Residents_Percent, Budgeted_Refunded_Programs_Percent, Budgeted_Projects_Percent, Budgeted_Transfers_Out_Percent, Budgeted_Refunded_Debt_Percent) |>
  filter(Year >= 2010, Year <= 2022)

str(budget)

```

*Actual Expenditure Data*

In cleaning the Iowa County Actual Expenditures Data, the County Name and Year were already in the desired format. The year was used to filter to ensure the data was between 2010 and 2024. "Total Expenditures" was kept and the various types of spending were transformed as a percentage of "Total Budget". 

```{r}

spend <- spend_raw |>
  rename(
    Year = `FISCAL YEAR`,
    Total_Expenditure = `TOTAL EXPENDITURES & OTHER USES`
  ) |>
  mutate(
    Actual_Public_Safety_Percent = `PUBLIC SAFETY AND LEGAL SERVICES` / Total_Expenditure,
    Actual_Mental_Health_Percent = `MENTAL HEALTH, ID & DD` / Total_Expenditure,
    Actual_Roads_Transportation_Percent = `ROADS & TRANSPORTATION` / Total_Expenditure,
    Actual_Administration_Percent = ADMINISTRATION / Total_Expenditure,
    Actual_Debt_Percent = `DEBT SERVICE` / Total_Expenditure,
    Actual_Physical_Health_Percent = `PHYSICAL HEALTH SOCIAL SERVICES` / Total_Expenditure,
    Actual_Environment_Education_Percent = `COUNTY ENVIRONMENT AND EDUCATION` / Total_Expenditure,
    Actual_Services_to_Residents_Percent = `GOVERNMENT SERVICES TO RESIDENTS` / Total_Expenditure,
    Actual_Refunded_Programs_Percent = `NONPROGRAM CURRENT` / Total_Expenditure,
    Actual_Projects_Percent = `CAPITAL PROJECTS` / Total_Expenditure,
    Actual_Transfers_Out_Percent = `OPERATING TRANSFERS OUT` / Total_Expenditure,
    Actual_Refunded_Debt_Percent = `REFUNDED DEBT/PAYMENTS TO ESCROW` / Total_Expenditure
  ) |>
  select(County, Year, Total_Expenditure, Actual_Public_Safety_Percent, Actual_Mental_Health_Percent, Actual_Roads_Transportation_Percent, Actual_Administration_Percent, Actual_Debt_Percent, Actual_Physical_Health_Percent, Actual_Environment_Education_Percent, Actual_Services_to_Residents_Percent, Actual_Refunded_Programs_Percent, Actual_Projects_Percent, Actual_Transfers_Out_Percent, Actual_Refunded_Debt_Percent) |>
  filter(Year >= 2010, Year <= 2022)

str(spend)

```

Now that each data set has been cleaned individually, they can now be joined on "County" and "Year".

```{r}

join1 <- inner_join(pop, income, by = c('County', 'Year'))
join2 <- inner_join(join1, rev, by = c('County', 'Year'))
join3 <- inner_join(join2, budget, by = c('County', 'Year'))
data <- inner_join(join3, spend, by = c('County', 'Year'))

# data |>
#  group_by(Year) |>
#  summarize(
#    count = n_distinct(County)
#  )

# sort(unique(data$County))
```

After checking that the join worked, it seemed that the use of an apostrophe in some data sets for O'Brien county did not work with the ones that did not so it was necessary to ensure this was fixed by going back and ensuring that any entry in the data sets with an apostrophe were replaced with the name without.

### Data Structure

```{r}

write.csv(data, 'data/Final_Data.csv')
str(data)
head(data, 5)

```

There are 1287 observations in this data set. This is to be expected considering there are 99 counties and 13 years considered between 2010 and 2022. 99 * 13 is 1287 meaning that each county is represented for each year. 

**Variables**

- County: The Name of the County in Iowa.

- Year: The Year of the Observation (between 2010 and 2022).

- Population: The Number of People Living in the County during the Year.

- Personal_Income: Total Number of Personal Income Earned.

- Personal_Income_Per_Capita: Total Personal Income divided by Population (*Note that this number comes from the State of Iowa Database and is not the number based on the Population and Personal_Income variables in the data set).

- Total_Revenue: Total Revenue brought in by the County during the Year.

- Revenue_Percent_Property_Tax: Percent of Total_Revenue that comes from Property Taxes.

- Revenue_Percent_Grant: Percent of Total_Revenue that comes from Grants from other Governments.

- Revenue_Percent_Activities: Percent of Total_Revenue that comes from Licenses/Permits, Charges for Government Goods and Services, and from the Use of Government Money and Property.

- Revenue_Percent_Other: Percent of Total_Revenue that comes from any other activity not already distinguished.

- Total_Budget: Total Annual Budget allocated by the County.

- Budgeted_Public_Safety_Percent: Percent of Total_Budget allocated to Public Safety.

- Budgeted_Mental_Health_Percent: Percent of Total_Budget allocated to Mental Health.

- Budgeted_Roads_Transportation_Percent: Percent of Total_Budget allocated to Roads and Transportation.

- Budgeted_Administration_Percent: Percent of Total_Budget allocated to Administration Expenses.

- Budgeted_Debt_Percent: Percent of Total_Budget allocated to repaying Debt.

- Budgeted_Physical_Health_Percent: Percent of Total_Budget allocated to Physical Health.

- Budgeted_Environment_Education_Percent: Percent of Total_Budget allocated to the Environment and Education.

- Budgeted_Services_to_Residents_Percent: Percent of Total_Budget allocated to Public Services.

- Budgeted_Refunded_Programs_Percent: Percent of Total_Budget allocated to "NonProgram Current" which includes the allocation of refunds from prior year revenues, pass-through grants, and county farm expenses.

- Budgeted_Projects_Percent: Percent of Total_Budget allocated to the completion of Capital Improvement Projects.

- Budgeted_Transfers_Out_Percent: Percent of Total_Budget allocated to loan transferring to repaying past Budgets.

- Budgeted_Refunded_Debt_Percent: Percent of Total_Budget allocated to repaying Debt Principals.

- Total_Expenditure: Total Actual Annual Expenditures by the County

- Actual_Public_Safety_Percent: Percent of Total_Expenditure spent on Public Safety.

- Actual_Mental_Health_Percent: Percent of Total_Expenditure spent on Mental Health.

- Actual_Roads_Transportation_Percent: Percent of Total_Expenditure spent on Roads and Transportation.

- Actual_Administration_Percent: Percent of Total_Expenditure spent on Administration Expenses.

- Actual_Debt_Percent: Percent of Total_Expenditure spent on repaying Debt.

- Actual_Physical_Health_Percent: Percent of Total_Expenditure spent on Physical Health.

- Actual_Environment_Education_Percent: Percent of Total_Expenditure spent on the Environment and Education.

- Actual_Services_to_Residents_Percent: Percent of Total_Expenditure spent on Public Services.

- Actual_Refunded_Programs_Percent: Percent of Total_Expenditure spent on "NonProgram Current" which includes the allocation of refunds from prior year revenues, pass-through grants, and county farm expenses.

- Actual_Projects_Percent: Percent of Total_Expenditure spent on the completion of Capital Improvement Projects.

- Actual_Transfers_Out_Percent: Percent of Total_Expenditure spent on loan transferring to repaying past Budgets.

- Actual_Refunded_Debt_Percent: Percent of Total_Expenditure spent on repaying Debt Principals.

## Results

### Differences in How Iowa Counties Receive their Funds

What are the general differences between counties in how much they make? 
How is this affected by a county’s population?
Does population affect how a county receives most of its funds?

```{r}


iowa <- map_data('county', 'iowa')

iowa <- iowa |>
  mutate(
    County = toupper(subregion)
  )

funding_data <- data |>
  group_by(County) |>
  summarize(
    `Revenue in Millions` = mean(Total_Revenue / 1000000),
    `Population in Thousands` = mean(Population / 1000),
    Income = mean(Personal_Income_Per_Capita),
    `Percent from Property Tax` = mean(Revenue_Percent_Property_Tax),
    `Percent from Grants` = mean(Revenue_Percent_Grant),
    `Percent from Activities` = mean(Revenue_Percent_Activities),
    `Percent from Other` = mean(Revenue_Percent_Other)
  ) |>
  left_join(iowa, by = 'County')

ggplot(funding_data, aes(x = long, y = lat, fill = `Revenue in Millions`)) + 
  geom_polygon(aes(group = group)) +
  scale_fill_gradient(low = '#4D4100', high = '#FFED00') +
  theme_void() +
  labs(title = "Revenue by County") +
  theme(
    plot.title = element_text(
      size = 20, 
      face = "bold",
      hjust = 0.5)
    )

```

This map shows the average Revenue in the millions for each county. This was created after merging R's county longitude and latitude data with the dataset that was grouped by County and the average for every year of Revenue, Population, and Income was found.

The map shows counties like Polk, Linn, Scott, and Johnson having the highest revenue. These cities hold the most population in the state, so at first glance it seems counties with a higher population hold a greater funding. 

```{r}

ggplot(funding_data, aes(x = long, y = lat, fill = `Population in Thousands`)) + 
  geom_polygon(aes(group = group)) +
  scale_fill_gradient(low = '#4D4100', high = '#FFED00') +
  theme_void() +
  labs(title = "Population by County") +
  theme(
    plot.title = element_text(
      size = 20, 
      face = "bold",
      hjust = 0.5)
    )

```

This shows the Iowa Counties by the average population every year in the thousands. This map looks very similar to the Revenue map, with counties with high population having high revenue and those with low population have low revenue.

```{r}

funding_data <- funding_data |>
  mutate(Revenue_by_Pop = (`Revenue in Millions` * 1000000) / (`Population in Thousands` * 1000))

ggplot(funding_data, aes(x = long, y = lat, fill = Revenue_by_Pop)) + 
  geom_polygon(aes(group = group)) +
  scale_fill_gradient(low = '#4D4100', high = '#FFED00') +
  theme_void() +
  labs(title = "Revenue to Population by County") +
  theme(
    plot.title = element_text(
      size = 20, 
      face = "bold",
      hjust = 0.5)
    )

```

In order to gain a better picture of how Population and Revenue are related, this map which shows the Revenue by Population for each county in Iowa was created. If Population and Revenue were directly correlated, one would expect that each county would be about the same color, meaning that each were funded equivalently by person. However, a range of counties in western Iowa show a much higher Revenue to Population ratio, meaning despite having fewer people, they make more money. Ringgold county stands out as having the highest ratio. It is the second smallest county in Iowa by population. Adams county, the smallest county, shows a high Revenue to Population ratio as well. It seems that while a higher population generally means a county will make more revenue, counties with smaller populations make more money per person than more populated counties. 

The population is logarithmically transformed to adjust for the wide range in population (large number of counties with low populations and fewer with higher).

```{r}

ggplot(funding_data, aes(x = log(`Population in Thousands`), 
                         y = Revenue_by_Pop, color = `Revenue in Millions`)) +
  geom_point() +
  labs(title = "Revenue by Population vs Population")

```

This scatterplot more clearly shows how as Population increases, the Revenue by Population decreasingly decreases. This means that there is some element of funding that provides counties with lower populations to gain revenue. One would expect that counties with a higher population will have a higher percent of their revenue come from Property Tax and Activities. Given this data, one may assume that counties with lower populations may receive more of their revenue in Grants from State and Federal programs.

```{r}

ggplot(funding_data, aes(x = log(`Population in Thousands`), 
                         y = `Percent from Property Tax`)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, col = "#FFED00") +
    labs(title = "Percent of Revenue from Property Tax by Population")

```

This graph proves what one would expect, that as Population increases the percent of revenue coming from Property Tax increases. 

```{r}

ggplot(funding_data, aes(x = log(`Population in Thousands`), y = `Percent from Activities`)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, col = "#FFED00") +
    labs(title = "Percent of Revenue from Activities by Population")

```

This graph shows the correlation between Population and Percent of Revenue that comes from Activities. It is clear that as one would expect, the higher the population, the higher percentage of revenue comes from county business activities. However, this is not as strong as it was for property tax and likely the counties with higher percentage coming from activities when compared to Population may have more economic business such as licensing, financial lending, and selling services like public transportation. 

```{r}

Ringgold <- funding_data |> dplyr::filter(County == "RINGGOLD")

#Ringgold

#funding_data

ggplot(funding_data, aes(x = log(`Population in Thousands`), y = `Percent from Grants`)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, col = "#FFED00") +
  geom_point(data = Ringgold, color = "red") +
  geom_text(data = Ringgold, aes(label = "Ringgold County"), size = 2.5, vjust = -0.5) +
  labs(title = "Percent of Revenue from Grants by Population")

```

This final graph shows a clear correlation between Population and the percentage of a County's Revenue that comes from Grants. This explains why counties with a lower population have more Revenue per Population than others. This money likely comes in the form of State of Federal Grants intended to support counties that may not have enough population to support their government spending. In the future, doing more research into these grants could give a more well-rounded picture of this phenomenon.

Ringgold County is highlighted in red. One can see that it has the highest proportion of its Revenue coming from intergovernmental grants and has the largest Revenue to Population ratio, showing the effect of these grants on Revenue despite population.

```{r}

ggplot(funding_data, aes(x = `Percent from Grants`, y = Revenue_by_Pop)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, col = "#FFED00") +
  geom_point(data = Ringgold, color = "red") +
  geom_text(data = Ringgold, aes(label = "Ringgold County"), size = 2.5, vjust = -0.5) +
  labs(title = "Percent of Revenue from Activities by Population")

```

This graph shows this relationship between the percentage of a county's Revenue comes from Grant and the Revenue to Population Ratio. As the county receives more grants as a percentage of their revenue, the Revenue by Population increases. Ringgold county is once again an outlier here as they simply make way more wealth then the population they actually have. This would require more in-depth future research on Ringgold county, but they may have been highly affected by storms, disasters, or poverty leading to significant intergovernmental funding despite a limited population.

### Differences in What a County Spends its Money on

What are the general differences between counties in how much they spend? 
How is this affected by a county’s population? How has this changed over time?
Does population and income affect what a county spends its money on? 

```{r}

spending_data <- data |>
  group_by(County) |>
  summarize(
    `Expenditure in Millions` = mean(Total_Expenditure / 1000000),
    `Revenue in Millions` = mean(Total_Revenue / 1000000),
    `Population in Thousands` = mean(Population / 1000),
    Income = mean(Personal_Income_Per_Capita),
    Actual_Public_Safety_Percent = mean(Actual_Public_Safety_Percent),
    Actual_Mental_Health_Percent = mean(Actual_Mental_Health_Percent),
    Actual_Roads_Transportation_Percent = mean(Actual_Roads_Transportation_Percent),
    Actual_Administration_Percent = mean(Actual_Administration_Percent),
    Actual_Debt_Percent = mean(Actual_Debt_Percent),
    Actual_Physical_Health_Percent = mean(Actual_Physical_Health_Percent),
    Actual_Environment_Education_Percent = mean(Actual_Environment_Education_Percent),
    Actual_Services_to_Residents_Percent = mean(Actual_Services_to_Residents_Percent),
    Actual_Refunded_Programs_Percent = mean(Actual_Refunded_Programs_Percent),
    Actual_Projects_Percent = mean(Actual_Projects_Percent),
    Actual_Transfers_Out_Percent = mean(Actual_Transfers_Out_Percent),
    Actual_Refunded_Debt_Percent = mean(Actual_Refunded_Debt_Percent)
  ) |>
  left_join(iowa, by = 'County')

ggplot(spending_data, aes(x = long, y = lat, fill = `Expenditure in Millions`)) + 
  geom_polygon(aes(group = group)) +
  scale_fill_gradient(low = '#4D4100', high = '#FFED00') +
  theme_void() +
  labs(title = "Expenditure by County") +
  theme(
    plot.title = element_text(
      size = 20, 
      face = "bold",
      hjust = 0.5)
    )

```

Now, in analyzing county expenditure, it is clear that, like Revenue, how much a county is highly related to population and highly related to the county's Revenue.

```{r}

spending_data <- spending_data |>
  mutate(Expenditure_by_Pop = (`Expenditure in Millions` * 1000000) / (`Population in Thousands` * 1000))

ggplot(spending_data, aes(x = long, y = lat, fill = Expenditure_by_Pop)) + 
  geom_polygon(aes(group = group)) +
  scale_fill_gradient(low = '#4D4100', high = '#FFED00') +
  theme_void() +
  labs(title = "Expenditure to Population by County") +
  theme(
    plot.title = element_text(
      size = 20, 
      face = "bold",
      hjust = 0.5)
    )

```

By now looking at the ratio of Spending to Population there is a clear difference in more rural Counties in the West and North. This means they spend more per person than the other counties. There are way more counties that have significantly higher Expenditure to Population ratios than there were with higher Revenue to Population ratios. This shows that there are many counties that spend more than they make leading to deficits. 

```{r}

ggplot(spending_data, aes(x = log(`Population in Thousands`), 
                         y = Expenditure_by_Pop)) +
  geom_point() +
  labs(title = "Expenditure by Population vs Population")

```

As with Revenue, it is clear that counties with a lower population spend more per person than counties with larger populations. 

```{r}

spending_data2 <- data |>
  group_by(County) |>
  summarize(
    `Expenditure in Millions` = mean(Total_Expenditure / 1000000),
    `Revenue in Millions` = mean(Total_Revenue / 1000000),
    `Population in Thousands` = mean(Population / 1000),
    Income = mean(Personal_Income_Per_Capita),
    Actual_Public_Safety_Percent = mean(Actual_Public_Safety_Percent),
    Actual_Mental_Health_Percent = mean(Actual_Mental_Health_Percent),
    Actual_Roads_Transportation_Percent = mean(Actual_Roads_Transportation_Percent),
    Actual_Administration_Percent = mean(Actual_Administration_Percent),
    Actual_Debt_Percent = mean(Actual_Debt_Percent),
    Actual_Physical_Health_Percent = mean(Actual_Physical_Health_Percent),
    Actual_Environment_Education_Percent = mean(Actual_Environment_Education_Percent),
    Actual_Services_to_Residents_Percent = mean(Actual_Services_to_Residents_Percent),
    Actual_Refunded_Programs_Percent = mean(Actual_Refunded_Programs_Percent),
    Actual_Projects_Percent = mean(Actual_Projects_Percent),
    Actual_Transfers_Out_Percent = mean(Actual_Transfers_Out_Percent),
    Actual_Refunded_Debt_Percent = mean(Actual_Refunded_Debt_Percent)
  ) |>
  pivot_longer(cols = Actual_Public_Safety_Percent:Actual_Refunded_Debt_Percent,
               names_to = 'Spending_Type',
               values_to = 'Percent')

top_10 <- spending_data2 |>
  group_by(County) |>
  summarize(`Population in Thousands` = mean(`Population in Thousands`)) |>
  arrange(desc(`Population in Thousands`)) |>
  head(10) |>
  pull(County)

lower_10 <- spending_data2 |>
  group_by(County) |>
  summarize(`Population in Thousands` = mean(`Population in Thousands`)) |>
  arrange(`Population in Thousands`) |>
  head(10) |>
  pull(County)

ten_to_ten <- c(top_10, lower_10)

ggplot(spending_data2 |> dplyr::filter(County %in% ten_to_ten),
       aes(x = reorder(County, `Population in Thousands`), y = Percent, 
           fill = reorder(Spending_Type, Percent, mean))) +
  geom_bar(stat = "identity", position = "stack") +
  coord_flip() +
  labs(title = "10 Most and Least Populous Counties Spending Type Distribution",
       fill = "Spending Type") +
  xlab('County') +
  ylab('Percentage')

```

This stacked bar chart shows the top 10 and bottom 10 counties regarding population and the makeup of their spending. It shows the clearest and most significant difference in the top 10 and bottom 10 counties regarding percent of Spending dedicated to Roads and Transportation, Public Safety, and mental health. 

```{r}

ggplot(spending_data, aes(x = log(`Population in Thousands`), 
                         y = Actual_Roads_Transportation_Percent)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, col = "#FFED00") +
  labs(title = "Percent of Expenditure on Roads by Population")

```

This scatterplot further shows how with an increase in Population, there is a decrease in the percentage of their expenditure a county spends on Roads and Transportation. This relationship is likely due to how most counties in Iowa are relatively the same in size and so generally spend similar amounts of money on maintaining the roads (likely the largest driver of expense here). Therefore counties with higher populations, and therefore higher revenues devout a smaller percentage of their wealth on Roads and Transportation.

```{r}

ggplot(spending_data, aes(x = log(`Population in Thousands`), 
                         y = Actual_Public_Safety_Percent)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, col = "#FFED00") +
  labs(title = "Percent of Expenditure on Public Safety by Population")

```

As seen in the bar chart, this scatterplot demonstrates that counties with a higher population devout more of their Expenditure towards public safety. This makes sense as counties with higher populations require more attention to public safety as crime rates are much higher in areas with higher populations. 

```{r}

ggplot(spending_data, aes(x = log(`Population in Thousands`), 
                         y = Actual_Mental_Health_Percent)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, col = "#FFED00") +
  labs(title = "Percent of Expenditure on Mental Health by Population")


# spending_data |>
#   arrange(desc(Actual_Mental_Health_Percent)) |>
#   head(1)

```

Once again, the bar chart is proven accurate as there is a clear positive relationship between Population and the Percent of Expenditure a County dedicates towards Mental Health. With higher populations, there are more people that require mental health services. Interesting here is that there is one outlier, Butler County. They likely put more emphasis on mental health in this particular county although further research would be interesting in determining why. It would also be ideal to look into each of the spending types further and compare it to population to see trends in all of them. This will help better understand how population affects how a county dedicated its Expenditures.

Overall these charts show that what a county spends money on is dependent on population. What about income?

```{r}

top_10 <- spending_data2 |>
  group_by(County) |>
  summarize(Income_Per_Capita = mean(Income / (`Population in Thousands` * 1000))) |>
  arrange(desc(Income_Per_Capita)) |>
  head(10) |>
  pull(County)

lower_10 <- spending_data2 |>
  group_by(County) |>
  summarize(Income_Per_Capita = mean(Income / (`Population in Thousands` * 1000))) |>
  arrange(Income_Per_Capita) |>
  head(10) |>
  pull(County)

ten_to_ten <- c(top_10, lower_10)

spending_data2 <- spending_data2 |>
  mutate(Income_Per_Capita = Income / (`Population in Thousands` *  1000))

ggplot(spending_data2 |> dplyr::filter(County %in% ten_to_ten),
       aes(x = reorder(County, Income), y = Percent, 
           fill = reorder(Spending_Type, Percent, mean))) +
  geom_bar(stat = "identity", position = "stack") +
  coord_flip() +
  labs(title = "10 Most and Least Wealthy Counties Spending Type Distribution",
       fill = "Spending Type") +
  xlab('County') +
  ylab('Percentage')

```

According to this stacked bar chart, which shows the Expenditure makeup of the top 10 and bottom 10 counties by Income Per Capita, there is little to no commonalty in percentages of spending type and income. Therefore there is likely no relationship between the wealth of a county's population and what the county spends its money on, according to this data.

### Differences in Budgeted and Actual Expenditures by Type of Spending

For each spending type, what is the difference between budgeted and actual expenditures?

```{r}

difference_data <- data |>
  mutate(
    Public_Safety_Difference = Actual_Public_Safety_Percent - Budgeted_Public_Safety_Percent,
    Mental_Health_Difference = Actual_Mental_Health_Percent - Budgeted_Mental_Health_Percent,
    Roads_Transportation_Difference = Actual_Roads_Transportation_Percent - Budgeted_Roads_Transportation_Percent,
    Administration_Difference = Actual_Administration_Percent - Budgeted_Administration_Percent,
    Debt_Difference = Actual_Debt_Percent - Budgeted_Debt_Percent,
    Physical_Health_Difference = Actual_Physical_Health_Percent - Budgeted_Physical_Health_Percent,
    Environment_Education_Difference = Actual_Environment_Education_Percent - Budgeted_Environment_Education_Percent,
    Services_to_Residents_Difference = Actual_Services_to_Residents_Percent - Budgeted_Services_to_Residents_Percent,
    Refunded_Programs_Difference = Actual_Refunded_Programs_Percent - Budgeted_Refunded_Programs_Percent,
    Projects_Difference = Actual_Projects_Percent - Budgeted_Projects_Percent,
    Transfers_Out_Difference = Actual_Transfers_Out_Percent - Budgeted_Transfers_Out_Percent,
    Refunded_Debt_Difference = Actual_Refunded_Debt_Percent - Budgeted_Refunded_Debt_Percent
  )

difference_data2 <- difference_data |>
  pivot_longer(cols = Public_Safety_Difference:Refunded_Debt_Difference,
               names_to = 'Spending_Type',
               values_to = 'Percent_Difference'
              ) |>
  group_by(Spending_Type) |>
  summarize(
    Percent_Difference = mean(Percent_Difference)
  )

ggplot(difference_data2, aes(x = reorder(Spending_Type, Percent_Difference), y = Percent_Difference)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(title = "Percent Difference for Each Spending Type") +
  xlab('Percent Difference') +
  ylab('Spending Type')

```

This bar chart shows the difference between the actual and budgeted spending for each spending type on average for every county for every year. Each area that a county can spend in shows a variety in how well counties are able to accurately budget. Some spending categories show very little difference between budgeted and actual spending. A good example of why this is comes from Public Safety and Administrative. These spending categories show very little need to change in a given year. For Public Safety, once a county budgets a certain amount for the year, there is little reason to change it and most of the money would be spent in a scheduled amount for a scheduled time. Similarly with Administrative expenses, most of the money there comes from salaries which are paid out yearly and slight personnel changes are not enough to change it within a year. For categories that see a county spend significantly more in than budgeted, there are two explanations. The one that is assumed is that changes in actual events causes governments to have to spend more than they expected. Governments are well known for their ability to overspend how much they budget. However, the only category type that makes sense with that explanation is Roads and Transportation. This is likely due to the fact that it is necessary for a government to invest heavily in maintaining roads and unforeseen weather changes may cause them to spend more than budgeted. However, the second explanation for the other overspending categories is that after a county has saved significant amounts of their revenue, they are likely to use the excess to pay off debt, which covers Transfers Out (Transfers out), Debt (Debt interest), and Repayed Debt (principals on debt). 

There are three spending types with a negative difference, meaning less is on average spent in that category than budgeted. Projects makes sense as project costs vary throughout a typical year and counties are likely seeing where they can save money. Mental and Physical Health are difficult to explain, but likely counties allocate significant money there for insurance and medical reimbursements for employees but do not often require that money to be spent. 

Overall, this shows that counties do not overspend as much as one might assume as they have enough excess budget towards the end of the year that they are able to use to pay off debt.

### Most Fiscally Responsible Counties

What counties are the best at following their budget and revenue? How has this changed over time?

```{r}

complete_difference <- data |>
  mutate(
    Spending_to_Budget_Difference = (Total_Expenditure - Total_Budget) / Total_Budget,
    Spending_to_Revenue_Difference = (Total_Expenditure - Total_Revenue) / Total_Revenue
  )

county_difference_data <- complete_difference |>
  group_by(County) |>
  summarize(
    Spending_to_Budget_Difference = mean(Spending_to_Budget_Difference),
    Spending_to_Revenue_Difference = mean(Spending_to_Revenue_Difference)
  ) |>
  left_join(iowa, by = 'County')

ggplot(county_difference_data, aes(x = long, y = lat, fill = Spending_to_Budget_Difference)) + 
  geom_polygon(aes(group = group)) +
  scale_fill_gradient2(low = '#22ff00', high = '#ff0000', mid = '#FFED00', midpoint = 0) +
  theme_void() +
  labs(title = "Expenditure to Budget Percent Difference by County") +
  theme(
    plot.title = element_text(
      size = 12, 
      face = "bold",
      hjust = 0.5)
    )

```

This map shows the difference in Expenditure and Budget for each county as a percentage of Budget. While the colors show high differences, the legend shows that most counties follow their budget very closely and do not spend more than 10% different in either direction. 

```{r}

county_difference_data2 <- complete_difference |>
  group_by(County) |>
  summarize(
    Spending_to_Budget_Difference = mean(abs(Spending_to_Budget_Difference)),
    Spending_to_Revenue_Difference = mean(abs(Spending_to_Revenue_Difference))
  ) |>
  left_join(iowa, by = 'County')

ggplot(county_difference_data2, aes(x = long, y = lat, fill = Spending_to_Budget_Difference)) + 
  geom_polygon(aes(group = group)) +
  scale_fill_gradient(low = '#4D4100', high = '#FFED00') +
  theme_void() +
  labs(title = "Absolute Expenditure to Budget Percent Difference by County") +
  theme(
    plot.title = element_text(
      size = 12, 
      face = "bold",
      hjust = 0.5)
    )

```

Using absolute values removes the cancelling out due to under and over spending. However, since underspending is not necessarily a gauge of whether a county is fiscally responsible it should not be taken into account. 

```{r}

ggplot(county_difference_data, aes(x = long, y = lat,
                                   fill = Spending_to_Revenue_Difference)) + 
  geom_polygon(aes(group = group)) +
  scale_fill_gradient2(low = '#22ff00', high = '#ff0000', mid = '#FFED00', midpoint = 0) +
  theme_void() +
  labs(title = "Expenditure to Revenue Percent Difference by County") +
  theme(
    plot.title = element_text(
      size = 12, 
      face = "bold",
      hjust = 0.5)
    )

```

This, that uses the difference in how much a county spends and their revenue as a percentage of their revenue, shows that most counties do a good job keeping to their budget. However, Monroe county in the south and the three counties in a cluster of Winnebago, Worth, and Mitchell all have higher average differences meaning that they generally overspend and so are less fiscally responsible.

```{r}

county_difference_data |>
  group_by(County) |>
  summarize(Spending_to_Revenue_Difference = mean(Spending_to_Revenue_Difference)) |>
  arrange(Spending_to_Revenue_Difference) |>
  head(5)

```

This shows that the most fiscally responsible counties are Ringgold, Delaware, Calhoun, Muscatine, and Decatur. 

Now how has that changed over time?

```{r}

top_5 <- complete_difference |>
  filter(County %in% c("RINGGOLD", "DELAWARE", "CALHOUN", "MUSCATINE", "DECATUR"))

complete_difference |>
  ggplot(aes(x = factor(Year), y = Spending_to_Revenue_Difference, group = County)) +
  geom_line() +
  geom_line(data = top_5,
            mapping = aes(x = factor(Year),
                          y = Spending_to_Revenue_Difference, group = County),
            color = 'yellow') +
  labs(title = "Fiscal Responsibility by Year") +
  xlab("Year") +
  ylab("Spending to Revenue Difference Percent")

```

This line graph shows how the top 5 all-time fiscally responsible counties compare on a year to year (seen in yellow). As expected, there is variety year to year as the requirements of every year vary for each individual county in different ways. What is surprising is that they do not categorically rank low, instead generally saving money in most year while other counties vary more widely. Except for Ringgold county, none appear to have many years where they consistently underspend significantly more than every other county.

```{r}

complete_difference <- complete_difference |>
  left_join(iowa, by = 'County')

ggplot(complete_difference, aes(x = long, y = lat,
                                   fill = Spending_to_Revenue_Difference)) + 
  geom_polygon(aes(group = group)) +
  scale_fill_gradient2(low = '#22ff00', high = '#ff0000', mid = '#FFED00', midpoint = 0) +
  theme_void() +
  labs(title = "Expenditure to Revenue Percent Difference Each Year") +
  theme(
    plot.title = element_text(
      size = 12, 
      face = "bold",
      hjust = 0.5)
    ) +
  facet_wrap(~Year)

```

Showing each year individually shows that there is too much variety year to year in whether counties underspend or overspend their revenue to gauge which are generally best. However, it shows that most counties are inclined to have years where they severely overspend, such as Monroe County in 2019, than years where they are more fiscally responsible. However, most years shows that the counties generally spend as much as they make.

## Conclusion

There are many things discovered through the use of this data. Population is a major factor in determining how counties Collect and Spend their wealth. Counties with more population, as expected, collect larger revenues but counties with smaller populations tend to have more revenue per person as they have a higher percentage of their revenue coming in from grants. Similarly, in spending money, due to counties in Iowa being roughly the same size, they must spend similar amounts of money in certain items like Roads meaning that counties with small populations must spend more money per person than counties with larger populations. 

The counties generally follow their budgets and rarely spend more or less than they earn in a given year with small exceptions. They are also more likely to overspend than underspend. It is hard to determine which counties are the most fiscally responsible as it varies considerable from year to year. 
